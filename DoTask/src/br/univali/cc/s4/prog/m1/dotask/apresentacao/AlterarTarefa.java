/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package br.univali.cc.s4.prog.m1.dotask.apresentacao;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import javax.swing.JOptionPane;
import br.univali.cc.s4.prog.m1.dotask.dominio.Tarefa;
import br.univali.cc.s4.prog.m1.dotask.persistencia.GerenciadorDadosMYSQL;
import java.sql.SQLException;
import java.time.LocalDateTime;
import java.time.Month;
import java.time.ZoneId;
import java.util.Calendar;
import java.util.Date;

/**
 *
 * @author marco
 */
public class AlterarTarefa extends javax.swing.JFrame {

    /**
     * Creates new form AlterarTarefa
     */
    public AlterarTarefa() {
        initComponents();
        
        setLocationRelativeTo(null);
        
        botaoBuscar.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                int id;
                Tarefa tarefa = null;
                GerenciadorDadosMYSQL gerenciadorDadosMYSQL = new GerenciadorDadosMYSQL();
                
                try{
                    id = Integer.valueOf(campoID.getText());
                    tarefa = gerenciadorDadosMYSQL.getTarefa(id);
                }catch (Exception ex){
                    JOptionPane.showMessageDialog(rootPane, ex.toString(), "Erro", JOptionPane.ERROR_MESSAGE);
                    return;
                }     
                
                if (tarefa == null){
                    JOptionPane.showMessageDialog(rootPane, "ID inválido", "Erro", JOptionPane.ERROR_MESSAGE);
                    return;

                }
                
                campoTextoNome.setText(tarefa.getNome());
                campoTextoTag.setText(tarefa.getTag());
                campoTextoEmail.setText(tarefa.getEmail());
                checkboxLembrar.setSelected(tarefa.getLembrar());
                coletorDataTempo.setDateTimePermissive(LocalDateTime.ofInstant(tarefa.getLembrarEm().toInstant(), ZoneId.systemDefault()));
            }
        });
        
        botaoAlterar.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                int id;
                String nome;
                String tag;
                boolean lembrar;
                String email;

                Date javaTimeStramp = new Date();
                LocalDateTime getTimestramp = LocalDateTime.now();
                Calendar timeInMillis = Calendar.getInstance();
                
                id = Integer.valueOf(campoID.getText());
                nome = campoTextoNome.getText();
                tag = campoTextoTag.getText();
                email = campoTextoEmail.getText();
                lembrar = checkboxLembrar.isSelected();
                
                try{
                    getTimestramp = coletorDataTempo.getDateTimePermissive();
                    timeInMillis.set(getTimestramp.getYear(), getTimestramp.getMonthValue()-1, getTimestramp.getDayOfMonth(), getTimestramp.getHour(), getTimestramp.getMinute(), getTimestramp.getSecond());
                    javaTimeStramp = new Date(timeInMillis.getTimeInMillis());
                }catch (NullPointerException ex){
                    JOptionPane.showMessageDialog(rootPane, "Selecione uma data válida", "Erro", JOptionPane.ERROR_MESSAGE);
                    return;
                }
                
                GerenciadorDadosMYSQL gerenciadorDadosMYSQL = new GerenciadorDadosMYSQL();
                
                try{
                    gerenciadorDadosMYSQL.alterarTarefa(nome, lembrar, javaTimeStramp, tag, email, id);
                }catch (SQLException ex){
                    JOptionPane.showMessageDialog(rootPane, ex.toString(), "Erro", JOptionPane.ERROR_MESSAGE);
                    return;
                }
                
                JOptionPane.showMessageDialog(rootPane, "Alterado com sucesso", "Informativo", JOptionPane.INFORMATION_MESSAGE);
            }
        });
        
        botaoCancelar.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                dispose();
            }
        });
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        painelSuperior = new javax.swing.JPanel();
        rotuloID = new javax.swing.JLabel();
        campoID = new javax.swing.JTextField();
        preenchedorCampoIDBotaoBuscar = new javax.swing.Box.Filler(new java.awt.Dimension(20, 0), new java.awt.Dimension(20, 0), new java.awt.Dimension(20, 32767));
        botaoBuscar = new javax.swing.JButton();
        preenchedorSuperiorDireito = new javax.swing.Box.Filler(new java.awt.Dimension(220, 0), new java.awt.Dimension(220, 0), new java.awt.Dimension(2000, 32767));
        painelCentral = new javax.swing.JPanel();
        rotuloNome = new javax.swing.JLabel();
        rotuloLembrarEm = new javax.swing.JLabel();
        rotuloTag = new javax.swing.JLabel();
        rotuloEmail = new javax.swing.JLabel();
        campoTextoNome = new javax.swing.JTextField();
        checkboxLembrar = new javax.swing.JCheckBox();
        coletorDataTempo = new com.github.lgooddatepicker.components.DateTimePicker();
        campoTextoEmail = new javax.swing.JTextField();
        campoTextoTag = new javax.swing.JTextField();
        painelInferior = new javax.swing.JPanel();
        preenchedorLateralInferior = new javax.swing.Box.Filler(new java.awt.Dimension(20, 0), new java.awt.Dimension(20, 0), new java.awt.Dimension(2000, 32767));
        botaoAlterar = new javax.swing.JButton();
        botaoCancelar = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Alterar Tarefa");
        setAlwaysOnTop(true);

        painelSuperior.setBorder(javax.swing.BorderFactory.createEmptyBorder(10, 10, 0, 0));
        painelSuperior.setLayout(new javax.swing.BoxLayout(painelSuperior, javax.swing.BoxLayout.LINE_AXIS));

        rotuloID.setText("ID: ");
        painelSuperior.add(rotuloID);
        painelSuperior.add(campoID);
        painelSuperior.add(preenchedorCampoIDBotaoBuscar);

        botaoBuscar.setText("Buscar");
        painelSuperior.add(botaoBuscar);
        painelSuperior.add(preenchedorSuperiorDireito);

        getContentPane().add(painelSuperior, java.awt.BorderLayout.NORTH);

        painelCentral.setLayout(new java.awt.GridBagLayout());

        rotuloNome.setText("Nome: ");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.ipadx = 29;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(14, 10, 0, 0);
        painelCentral.add(rotuloNome, gridBagConstraints);

        rotuloLembrarEm.setText("Lembrar em: ");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(11, 10, 0, 0);
        painelCentral.add(rotuloLembrarEm, gridBagConstraints);

        rotuloTag.setText("Tag:");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.ipadx = 41;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(14, 10, 0, 0);
        painelCentral.add(rotuloTag, gridBagConstraints);

        rotuloEmail.setText("Email:");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 7;
        gridBagConstraints.ipadx = 35;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(14, 10, 0, 0);
        painelCentral.add(rotuloEmail, gridBagConstraints);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.gridheight = 2;
        gridBagConstraints.ipadx = 244;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(11, 4, 0, 50);
        painelCentral.add(campoTextoNome, gridBagConstraints);

        checkboxLembrar.setText("Lembrar");
        checkboxLembrar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                checkboxLembrarActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.ipady = -6;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(7, 4, 0, 0);
        painelCentral.add(checkboxLembrar, gridBagConstraints);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.gridheight = 2;
        gridBagConstraints.ipadx = 10;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(7, 4, 0, 50);
        painelCentral.add(coletorDataTempo, gridBagConstraints);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 7;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.gridheight = 2;
        gridBagConstraints.ipadx = 244;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(11, 4, 23, 50);
        painelCentral.add(campoTextoEmail, gridBagConstraints);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.gridheight = 2;
        gridBagConstraints.ipadx = 244;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(11, 4, 0, 50);
        painelCentral.add(campoTextoTag, gridBagConstraints);

        getContentPane().add(painelCentral, java.awt.BorderLayout.CENTER);

        painelInferior.setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));
        painelInferior.setLayout(new javax.swing.BoxLayout(painelInferior, javax.swing.BoxLayout.LINE_AXIS));
        painelInferior.add(preenchedorLateralInferior);

        botaoAlterar.setText("Alterar");
        botaoAlterar.setMaximumSize(new java.awt.Dimension(75, 23));
        botaoAlterar.setMinimumSize(new java.awt.Dimension(75, 23));
        botaoAlterar.setPreferredSize(new java.awt.Dimension(75, 23));
        painelInferior.add(botaoAlterar);

        botaoCancelar.setText("Cancelar");
        painelInferior.add(botaoCancelar);

        getContentPane().add(painelInferior, java.awt.BorderLayout.SOUTH);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void checkboxLembrarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_checkboxLembrarActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_checkboxLembrarActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(AlterarTarefa.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(AlterarTarefa.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(AlterarTarefa.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(AlterarTarefa.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new AlterarTarefa().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton botaoAlterar;
    private javax.swing.JButton botaoBuscar;
    private javax.swing.JButton botaoCancelar;
    private javax.swing.JTextField campoID;
    private javax.swing.JTextField campoTextoEmail;
    private javax.swing.JTextField campoTextoNome;
    private javax.swing.JTextField campoTextoTag;
    private javax.swing.JCheckBox checkboxLembrar;
    private com.github.lgooddatepicker.components.DateTimePicker coletorDataTempo;
    private javax.swing.JPanel painelCentral;
    private javax.swing.JPanel painelInferior;
    private javax.swing.JPanel painelSuperior;
    private javax.swing.Box.Filler preenchedorCampoIDBotaoBuscar;
    private javax.swing.Box.Filler preenchedorLateralInferior;
    private javax.swing.Box.Filler preenchedorSuperiorDireito;
    private javax.swing.JLabel rotuloEmail;
    private javax.swing.JLabel rotuloID;
    private javax.swing.JLabel rotuloLembrarEm;
    private javax.swing.JLabel rotuloNome;
    private javax.swing.JLabel rotuloTag;
    // End of variables declaration//GEN-END:variables
}
